<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Company Tags</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="stylesheet" href="styles.css" />
    <script>
      // Redirect to login if no JWT
      (function(){
        var token = localStorage.getItem('access_token');
        if (!token) { window.location.href = 'login.html'; }
      })();
    </script>
    <script defer src="api.js"></script>
    <style>
        .tag-page { max-width: 800px; margin: 32px auto; background: #fff; border: 1px solid #e5e7eb; border-radius: 12px; padding: 20px; }
        .tag-header { display:flex; justify-content: space-between; align-items:center; margin-bottom: 16px; }
        .tag-list { border-top: 1px solid #e5e7eb; }
        .tag-row { display:flex; justify-content: space-between; align-items:center; padding: 10px 0; border-bottom: 1px solid #f3f4f6; }
        .tag-actions button { margin-left: 8px; }
        .input { padding: 8px 10px; border: 1px solid #d1d5db; border-radius: 8px; }
        .btn { padding: 8px 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; }
        .btn-primary { background: #4f46e5; color: #fff; }
        .btn-secondary { background: #6b7280; color: #fff; }
        .muted { color: #6b7280 }
    </style>
</head>
<body>
    <div class="tag-page">
        <div class="tag-header">
            <h2>Company Tags</h2>
            <div>
                <input class="input" id="newTagName" placeholder="New tag name (e.g., Google)" />
                <button class="btn btn-primary" id="addTagBtn">Add</button>
                <a href="index.html" class="btn btn-secondary">Back</a>
            </div>
        </div>
        <div id="tagList" class="tag-list"></div>
        <div class="muted" style="margin-top:8px">Tip: You can assign tags to problems from the main page using the Tags button.</div>
    </div>

    <script>
        async function loadTags() {
            const list = document.getElementById('tagList');
            list.innerHTML = '';
            try {
                const tags = await api.listCompanyTags();
                if (!tags || tags.length === 0) {
                    const empty = document.createElement('div');
                    empty.className = 'muted';
                    empty.style.padding = '12px 0';
                    empty.textContent = 'No tags yet. Add your first company tag above.';
                    list.appendChild(empty);
                    return;
                }
                tags.forEach(tag => {
                    const row = document.createElement('div');
                    row.className = 'tag-row';
                    row.innerHTML = `
                        <div>
                            <input class="input" value="${tag.name}" data-tag-id="${tag.id}"/>
                        </div>
                        <div class="tag-actions">
                            <button class="btn btn-primary" data-action="save" data-tag-id="${tag.id}">Save</button>
                            <button class="btn" data-action="delete" data-tag-id="${tag.id}">Delete</button>
                        </div>
                    `;
                    list.appendChild(row);
                });
            } catch (e) {
                const err = document.createElement('div');
                err.className = 'muted';
                err.style.padding = '12px 0';
                err.textContent = 'Failed to load company tags.';
                list.appendChild(err);
            }
        }

        document.getElementById('addTagBtn').addEventListener('click', async () => {
            const name = document.getElementById('newTagName').value.trim();
            if (!name) return;
            await api.createCompanyTag(name);
            document.getElementById('newTagName').value = '';
            await loadTags();
        });

        document.getElementById('tagList').addEventListener('click', async (e) => {
            const btn = e.target.closest('button');
            if (!btn) return;
            const id = parseInt(btn.dataset.tagId, 10);
            if (btn.dataset.action === 'save') {
                const input = document.querySelector(`input[data-tag-id="${id}"]`);
                await api.updateCompanyTag(id, input.value.trim());
                await loadTags();
            } else if (btn.dataset.action === 'delete') {
                if (!confirm('Delete this tag?')) return;
                await api.deleteCompanyTag(id);
                await loadTags();
            }
        });

        loadTags();
    </script>
</body>
</html>


